if (self.CavalryLogger) { CavalryLogger.start_js(["Dunc7"]); }

__d("AlbumFollowStatusEnum",[],(function a(b,c,d,e,f,g){f.exports={FOLLOW:0,FOLLOW_AND_GET_NEW_POST_NOTIFS:1,UNFOLLOW:2,INELIGIBLE:3};}),null);
__d("XAlbumFollowStatusController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/album\/follow\/",{album_id:{type:"Int"},action:{type:"Enum",enumType:0}});}),null);
__d('FollowAlbumButton',['csx','cx','AlbumFollowStatusEnum','AsyncRequest','CSS','DOM','Event','MarauderLogger','Run','SubscriptionsHandler','XAlbumFollowStatusController'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=500;function k(l,m,n,o){this.$FollowAlbumButton1=l;this.$FollowAlbumButton2=m;this.$FollowAlbumButton3=n;this.$FollowAlbumButton4=o;this.$FollowAlbumButton5=new (c('SubscriptionsHandler'))();this.$FollowAlbumButton5.addSubscriptions(c('Event').listen(this.$FollowAlbumButton2,'click',this.follow.bind(this)),c('Event').listen(this.$FollowAlbumButton1,'click',function(p){p.preventDefault();}));this.$FollowAlbumButton7=false;this.$FollowAlbumButton3&&this.$FollowAlbumButton3.subscribe('itemclick',function(p,q){var r=parseInt(q.item.getValue(),10);if(r===c('AlbumFollowStatusEnum').FOLLOW_AND_GET_NEW_POST_NOTIFS){this.notifs();}else if(r===c('AlbumFollowStatusEnum').FOLLOW){this.follow(null);}else if(r===c('AlbumFollowStatusEnum').UNFOLLOW)this.unfollow();this.$FollowAlbumButton7=true;}.bind(this));this.$FollowAlbumButton3&&this.$FollowAlbumButton3.subscribe('show',function(p,q){c('MarauderLogger').log('album_follow_status_cta_tapped','albums_follow_status_button',{album_id:this.$FollowAlbumButton4.id,user_id:this.$FollowAlbumButton4.userid});}.bind(this));this.$FollowAlbumButton3&&this.$FollowAlbumButton3.subscribe('hide',function(p,q){if(!this.$FollowAlbumButton7)c('MarauderLogger').log('album_follow_status_cta_cancel','albums_follow_status_button',{album_id:this.$FollowAlbumButton4.id,user_id:this.$FollowAlbumButton4.userid});this.$FollowAlbumButton7=false;}.bind(this));c('Run').onLeave(this.cleanUp.bind(this));}k.prototype.getButtons=function(){return c('DOM').scry(this.$FollowAlbumButton1,"._4o8q");};k.prototype.getSelected=function(){var l=this.getButtons(),m=null;l.forEach(function(n){var o=parseInt(n.getAttribute('data-status'),10);if(c('CSS').matchesSelector(n,"._4o8v"))m=o;});return m;};k.prototype.follow=function(l){this.setSelected(c('AlbumFollowStatusEnum').FOLLOW);l&&l.preventDefault();l&&l.stopPropagation();};k.prototype.unfollow=function(){this.setSelected(c('AlbumFollowStatusEnum').UNFOLLOW);};k.prototype.notifs=function(){this.setSelected(c('AlbumFollowStatusEnum').FOLLOW_AND_GET_NEW_POST_NOTIFS);};k.prototype.updateSelectedUI=function(l){var m=l===c('AlbumFollowStatusEnum').UNFOLLOW?c('AlbumFollowStatusEnum').UNFOLLOW:c('AlbumFollowStatusEnum').FOLLOW,n=this.getButtons();n.forEach(function(o){var p=parseInt(o.getAttribute('data-status'),10);if(p===m){c('CSS').addClass(o,"_2z1j");}else c('CSS').removeClass(o,"_2z1j");});this.$FollowAlbumButton3.forEachItem(function(o){if(l!==parseInt(o.getValue(),10)){c('CSS').addClass(o.getRoot(),"_2z1j");}else c('CSS').removeClass(o.getRoot(),"_2z1j");});};k.prototype.setSelected=function(l){this.$FollowAlbumButton6=this.getSelected();this.updateSelectedUI(l);this.setLoading(true);var m=c('XAlbumFollowStatusController').getURIBuilder().setInt('album_id',this.$FollowAlbumButton4.id).setEnum('action',l).getURI();new (c('AsyncRequest'))().setURI(m).setMethod('POST').setHandler(function(n){this.updateSelectedUI(n.payload);setTimeout(function(){this.setLoading(false);}.bind(this),j);}.bind(this)).setErrorHandler(function(n){this.$FollowAlbumButton6!==null&&this.updateSelectedUI(this.$FollowAlbumButton6);setTimeout(function(){this.setLoading(false);}.bind(this),j);}).send();};k.prototype.setLoading=function(l){if(this.$FollowAlbumButton1)c('CSS').conditionClass(this.$FollowAlbumButton1,"_2z1k",l);};k.prototype.cleanUp=function(){this.$FollowAlbumButton5&&this.$FollowAlbumButton5.release();};f.exports=k;}),null);